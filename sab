-- JOIN SCRIPT â€“ UI + KICK HOST ON JOIN (Run in FRIEND's executor)
local Players = game:GetService("Players")
local DataStoreService = game:GetService("DataStoreService")
local GuiService = game:GetService("GuiService")
local SoundService = game:GetService("SoundService")
local player = Players.LocalPlayer

if player.UserId ~= 5868204126 then
    print("JOIN SCRIPT: Only run on UserId 5868204126")
    return
end

local store = DataStoreService:GetGlobalDataStore()
local INVITE_KEY = "JoinInvite_2551851736"
local KICK_KEY   = "KickHost_2551851736"
local retryConnection

-- === JOIN SOUND ===
local joinSound = Instance.new("Sound")
joinSound.SoundId = "rbxassetid://9114487369"  -- Ding!
joinSound.Volume = 0.7
joinSound.Parent = SoundService

local function playSound()
    if joinSound.IsPlaying then joinSound:Stop() end
    joinSound.TimePosition = 0
    joinSound:Play()
end

-- === FETCH INVITE ===
local success, data = pcall(function()
    return store:GetAsync(INVITE_KEY)
end)

if not success or not data then
    print("No invite found.")
    return
end

if os.time() - (data.time or 0) > 300 then
    print("Invite expired.")
    return
end

-- === GUI ===
local screen = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui")
gui.Name = "JoinHostUI"
gui.ResetOnSpawn = false
gui.Parent = screen

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 340, 0, 160)
frame.Position = UDim2.new(0.5, -170, 0.5, -80)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 2
frame.BorderColor3 = Color3.fromRGB(100, 100, 100)
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "Join " .. (data.name or "Host") .. "'s Server?"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -20, 0, 30)
status.Position = UDim2.new(0, 10, 0, 45)
status.BackgroundTransparency = 1
status.Text = "Ready"
status.TextColor3 = Color3.fromRGB(200, 255, 200)
status.Font = Enum.Font.Gotham
status.TextScaled = true
status.Parent = frame

local joinBtn = Instance.new("TextButton")
joinBtn.Size = UDim2.new(0, 140, 0, 50)
joinBtn.Position = UDim2.new(0.5, -150, 1, -65)
joinBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
joinBtn.Text = "JOIN"
joinBtn.TextColor3 = Color3.new(1, 1, 1)
joinBtn.Font = Enum.Font.GothamBold
joinBtn.Parent = frame

local retryBtn = Instance.new("TextButton")
retryBtn.Size = UDim2.new(0, 140, 0, 50)
retryBtn.Position = UDim2.new(0.5, 10, 1, -65)
retryBtn.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
retryBtn.Text = "RETRY (1s)"
retryBtn.TextColor3 = Color3.new(0, 0, 0)
retryBtn.Font = Enum.Font.GothamBold
retryBtn.Visible = false
retryBtn.Parent = frame

-- === KICK HOST + JOIN ===
local function kickAndJoin()
    playSound()
    status.Text = "Kicking host..."
    status.TextColor3 = Color3.fromRGB(255, 200, 100)

    -- Send kick signal
    pcall(function()
        store:SetAsync(KICK_KEY, true)
    end)

    -- Wait a moment for host to kick
    wait(1.5)

    local url = string.format(
        "roblox://placeId=%d&gameInstanceId=%s",
        data.placeId, data.jobId
    )

    status.Text = "Joining..."
    local opened = pcall(function()
        GuiService:OpenBrowser(url)
    end)

    if opened then
        wait(2)
        if player.Parent then
            status.Text = "Failed (retry?)"
            status.TextColor3 = Color3.fromRGB(255, 100, 100)
            joinBtn.Visible = false
            retryBtn.Visible = true
        else
            gui:Destroy()
        end
    else
        status.Text = "Link failed"
        status.TextColor3 = Color3.fromRGB(255, 100, 100)
    end
end

joinBtn.MouseButton1Click:Connect(function()
    joinBtn.Visible = false
    kickAndJoin()
end)

retryBtn.MouseButton1Click:Connect(function()
    playSound()
    retryBtn.Text = "RETRYING..."
    retryBtn.Active = false

    retryConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if not player.Parent then
            if retryConnection then retryConnection:Disconnect() end
            gui:Destroy()
            return
        end

        pcall(function()
            store:SetAsync(KICK_KEY, true)  -- re-kick if needed
        end)
        wait(1)
        local url = string.format(
            "roblox://placeId=%d&gameInstanceId=%s",
            data.placeId, data.jobId
        )
        pcall(function()
            GuiService:OpenBrowser(url)
        end)
    end)

    delay(30, function()
        if retryConnection then
            retryConnection:Disconnect()
            retryBtn.Text = "GAVE UP"
            retryBtn.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        end
    end)
end)

print("UI ready! Click JOIN to kick host and take slot.")
